var mql = window.matchMedia('(orientation: portrait)');

function handleOrientationChange(mql) {
    if(mql.matches) {
        $("#main").height($(window).height());
    }else {
        $("#main").height($(window).height());
    }
}
// 输出当前屏幕模式
handleOrientationChange(mql);
// 监听屏幕模式变化
mql.addListener(handleOrientationChange);

$("#main").height($(window).height());
var wl = window.location;
var pathUrl = "http://" + wl.host + wl.pathname.replace(/\w+\.html$/, "");
var wxdata = {};
var wximg = pathUrl + "images/share.jpg";
wxdata = {
    signUrl: wl.href.split("#")[0],
    link: pathUrl,
    img: wximg,
    title: "快来和我感性开跑",
    desc: "跟上我的脚步，还能赢取元气好礼！",
    timeLineTitle: "捉摸不定的不是天气，是妳",
    timeLineImg: wximg
};
$.get("http://campaign.adidas.cn/atr/interface/api/get_sign_package", {
    url: wxdata.signUrl
},
function(a) {
    setWxConfig(a.data);
},
"jsonp");
function setWxConfig(a) {
    wx.config({
        debug: false,
        appId: a.appId,
        timestamp: a.timestamp,
        nonceStr: a.nonceStr,
        signature: a.signature,
        jsApiList: ["onMenuShareTimeline", "onMenuShareAppMessage"]
    });
    wx.error(function(b) {});
    setWxData();
}
function setWxData() {
    wx.ready(function() {
        wx.onMenuShareTimeline({
            title: wxdata.timeLineTitle,
            link: wxdata.link,
            imgUrl: wxdata.timeLineImg,
            success: function() {},
            cancel: function() {}
        });
        wx.onMenuShareAppMessage({
            title: wxdata.title,
            desc: wxdata.desc,
            link: wxdata.link,
            imgUrl: wxdata.img,
            type: "",
            dataUrl: "",
            success: function() {},
            cancel: function() {}
        });
    });
}
var g_url = "http://campaign.adidas.cn/atr/interface/";
$("body").on("touchmove",
function(a) {
    a.preventDefault();
});
function getsearchString(a) {
    var b = new RegExp("(^|&)" + a + "=([^&]*)(&|$)", "i");
    var c = location.search.substr(1).match(b);
    if (c != null) {
        return decodeURI(c[2]);
    }
    return "";
}
var source = getsearchString("source");
var clear_cookie = getsearchString("clear");
if (clear_cookie) {
    if (localStorage._adMoble != null) {
        localStorage.clear();
    }
}
var lottery = "0";
var coupon = "0";
var manifest = [];
var imglength = 0;
$(".box-step img").each(function(a, b) {
    if (!$(this).attr("src")) {
        return;
    }
    manifest.push({
        src: $(this).attr("src"),
        id: "images_" + a
    });
});
var queue = new createjs.LoadQueue(false);
$.get(g_url + "/api/get_image_list?rows=10&page=1&is_kv=1",
function(d) {
    var c = "";
    for (var b = 0; b < d.data.image.length; b++) {
        c += "<div id='slide" + (b + 5) + "' class='slide slide" + (b + 5) + "' style='background-image: url(" + g_url + d.data.image[b].image_url + ");'></div>";
        manifest.push({
            src: g_url + d.data.image[b].image_url,
            id: "image_kv" + b
        });
    }
    $("#img_list").append(c);
    //轮播图个数
    imglength = d.data.image.length + 6;
    var a = $(".loading p");
    queue.on("complete", handleComplete);
    queue.on("progress",
    function(g) {
        var f = parseInt(g.progress * 99);
        a.text(f + "%");
    });
    queue.loadManifest(manifest);
},
"jsonp");
function handleComplete() {
    $(".loading").fadeOut(200);
    $(".zhuquan1").fadeIn(200);
    initRoll(imglength);
    ga("send", "pageview", "Landing");
    if (!is_weixin()) {
        $(".s6-1").find("img").eq(0).show();
        $(".s6-btn1").show();
        $(".s6-btn2").removeClass("on").addClass("off");
    } else {
        $(".s6-1").find("img").eq(1).show();
    }
    try {
        if (localStorage._adMoble != null) {
            $.get(g_url + "api/get_userinfo?mobile=" + localStorage._adMoble,
            function(b) {
                if (b.error_code == "0") {
                    lottery = b.data.userinfo.lottery;
                    coupon = b.data.userinfo.coupon;
                }
            },
            "jsonp");
        }
    } catch(a) {}
}
var penAni = "";
function setPen() {
    if (penAni == "") {
        penAni = $(".pen").spritespin({
            source: SpriteSpin.sourceArray("images/q1/{frame}.jpg", {
                frame: [1, 17],
                digits: 1
            }),
            width: 640,
            height: 1136,
            frameTime: 150,
            renderer: "canvas",
            loop: true
        }).spritespin("api");
    }
}
// $$(".zhuquan1").bind("swipeUp",
// function() {
//     ClickEvent("ENG", "ENG_P1_Coupon", "Click");
//     ga("send", "pageview", "ENG_Prize");
//     $(".zhuquan1").hide();
//     $(".zhuquan4").show();
// });
$(".s1-btn11").click(function() {
    ClickEvent("ENG", "ENG_P1_Start", "Click");
    ga("send", "pageview", "ENG_Prize");
    $(".zhuquan1").fadeOut();
    $(".zhuquan5").fadeIn();
    ga("send", "pageview", "ENG_Interaction1");
    setPen();
    initPhotoClip();
});
$(".icon-9").click(function() {
    $(".ajax_loading").fadeIn();
    ClickEvent("GE", "GE_P1_Gallery", "Click");
    ga("send", "pageview", "ENG_Gallery");
    $(".zhuquan1").fadeOut();
    $(".zhuquan2").show();
    $.get(g_url + "/api/get_image_list?rows=50000&page=1",
    function(c) {
        $(".ajax_loading").fadeOut();
        var b = '<li vSrc="images/1-kv.jpg"><img src="images/1-kv.jpg"/></li><li vSrc="images/1-kv2.jpg"><img src="images/1-kv2.jpg"/></li><li vSrc="images/1-kv3.jpg"><img src="images/1-kv3.jpg"/></li>';
        for (var a = 0; a < c.data.image.length; a++) {
            b += '<li vSrc="' + g_url + c.data.image[a].image_url + '"><img src="' + g_url + c.data.image[a].image_url + '"/></li>';
        }
        $("#images-list").html(b);
        picIscroll.refresh();
    },
    "jsonp");
    $$("body").off("swipeLeft").off("swipeRight");
});

$(".zhuquan9").find(".go_back").click(function(a) {
    $(".zhuquan9").hide();
    $(".zhuquan1").show();
});
$(".zhuquan5").find(".go_back").click(function(a) {
    $(".zhuquan5").hide();
    $(".zhuquan1").show();
});
$(".zhuquan2").find(".go_back").click(function(a) {
    $(".zhuquan2").hide();
    $(".zhuquan1").show();
});
$(".zhuquan4").find(".go_back").click(function(a) {
    $(".zhuquan4").hide();
    $(".zhuquan1").show();
});
$(".icon-8").click(function() {
    ClickEvent("GE", "GE_P1_Rule", "Click");
    $(".popbox2").fadeIn();
    ruleIscroll.refresh();
});
$(".chk2-1-1").click(function(a) {
    $(".popbox3").fadeIn();
    huiyuanIscroll.refresh();
});
$(".back").click(function() {
    $(".popbox2,.popbox3").fadeOut();
});
$(".s8-btn1").click(function(a) {
    ClickEvent("ENG", "ENG_Shoe2_Start", "Click");
    $(".zhuquan8").hide();
    $(".zhuquan5").fadeIn();
    setPen();
    initPhotoClip();
});
$(".s8-btn2").click(function(a) {
    ClickEvent("ENG", "ENG_Shoe2_EC", "Click");
    setTimeout(function() {
        location.href = "https://www.adidas.com.cn/running_ultraboostxatr";
    },
    300);
});
$$(".s2-2").on("tap", "li",
function() {
    ClickEvent("GE", "ENG_Gallery_View", "Click");
    var a = $(this).attr("vSrc");
    $(".s3-bj").css("background-image", "url(" + a + ")");
    $(".zhuquan3").fadeIn();
    $(this).off("click");
});
$(".s3-close,.s3-bj").click(function() {
    $(".zhuquan3").fadeOut();
});
$(".s2-btn ,.s3-btn").click(function() {
    if ($(this).hasClass("s2-btn")) {
        ClickEvent("ENG", "ENG_Gallery_Create", "Click");
    } else {
        ClickEvent("ENG", "ENG_Gallery_Crea", "Click");
    }
    $(".zhuquan2,.zhuquan3").fadeOut();
    $(".zhuquan5").fadeIn();
    setPen();
    initPhotoClip();
});
$(".s4-btn").click(function() {
    ClickEvent("ENG", "ENG_Prize_Create", "Click");
    $$("body").off("swipeLeft").off("swipeRight");
    ga("send", "pageview", "ENG_Interaction1");
    $(".zhuquan4").fadeOut();
    $(".zhuquan5").fadeIn();
    setPen();
    initPhotoClip();
});
var parallax;
if (parallax) {
    parallax.disable();
}
// // parallax = new Parallax($(".zhuquan9")[0]);
// parallax.limit(120, 120);
// parallax.scalar(10, 6);
// var photoClip;
// function initPhotoClip() {
//     if (photoClip) {
//         photoClip.destroy();
//         photoClip = null;
//         iput_index = 0;
//         $(".ipt1").val("迎风奔跑");
//         $(".ipt2").val("逆光飞翔");
//         $(".s5-2 .upload_file").show();
//     }
//     photoClip = new PhotoClip("#clipArea", {
//         outputSize: [640, 1038],
//         adaptive: ["100%", "100%"],
//         file: ".upload_file",
//         view: "#view",
//         style: "",
//         ok: ".s5-4-2",
//         loadStart: function() {
//             console.log("开始读取照片");
//             ClickEvent("ENG", "ENG_INT1_Upload", "Click");
//             $(".ajax_loading").fadeIn();
//         },
//         loadComplete: function() {
//             console.log("照片读取完成");
//             $(".s5-2 .upload_file").hide();
//             $(".ajax_loading").fadeOut();
//         },
//         done: function(a) {
//             ClickEvent("ACE", "ACE_INT1_UGC", "Click");
//             setPic(a);
//         },
//         loadError: function(a) {
//             alert(a);
//         },
//         fail: function(a) {
//             alert(a);
//         }
//     });
// }
var image_id = "";
function setPic(d) {
    var b = $(".ipt1");
    var a = $(".ipt2");
    if (b.val() == "") {
        alert("请输入上一秒文字！");
        return;
    }
    if (a.val() == "") {
        alert("请输入下一秒文字！");
        return;
    }
    var c = {
        imgdata: d,
        text1: b.val(),
        text2: a.val()
    };
    $(".ajax_loading").fadeIn();
    $.post(g_url + "api/create_img?r=" + Math.random(), c,
    function(e) {
        $(".ajax_loading").fadeOut();
        if (e.error_code == 0) {
            $(".s6-bj").css("backgroundImage", "url(" + e.data.image_url + ")");
            $(".s6-img").attr("src", e.data.image_url);
            image_id = e.data.image_id;
            if (localStorage.coupon) {
                localStorage.removeItem("coupon");
            }
            $(".zhuquan5").fadeOut();
            $(".zhuquan6").fadeIn();
            ga("send", "pageview", "ENG_UGC");
            wx.onMenuShareTimeline({
                title: wxdata.timeLineTitle,
                link: pathUrl + "share.html?imgid=" + image_id,
                imgUrl: wximg,
                success: function() {},
                cancel: function() {}
            });
            wx.onMenuShareAppMessage({
                title: wxdata.title,
                desc: wxdata.desc,
                link: pathUrl + "share.html?imgid=" + image_id,
                imgUrl: wximg,
                success: function() {},
                cancel: function() {}
            });
        } else {
            alert(e);
        }
    },
    "json");
}
var iput_index = 0;
var iput_array = [{
    txt1: "迎风奔跑",
    txt2: "逆光飞翔"
},
{
    txt1: "火锅撸串",
    txt2: "跑步流汗"
},
{
    txt1: "血槽已空",
    txt2: "满血复活"
},
{
    txt1: "高能预警",
    txt2: "元气开跑"
}];
$(".s5-3").on("swipeLeft",
function() {
    iput_index++;
    if (iput_index == iput_array.length) {
        iput_index = 0;
    }
    $(".s5-3 .ipt1").val(iput_array[iput_index].txt1);
    $(".s5-3 .ipt2").val(iput_array[iput_index].txt2);
}).on("swipeRight",
function() {
    iput_index--;
    if (iput_index == -1) {
        iput_index = iput_array.length - 1;
    }
    $(".s5-3 .ipt1").val(iput_array[iput_index].txt1);
    $(".s5-3 .ipt2").val(iput_array[iput_index].txt2);
});
$(".s5-3-left").click(function(a) {
    iput_index++;
    if (iput_index == iput_array.length) {
        iput_index = 0;
    }
    $(".s5-3 .ipt1").val(iput_array[iput_index].txt1);
    $(".s5-3 .ipt2").val(iput_array[iput_index].txt2);
});
$(".s5-3-right").click(function(a) {
    iput_index++;
    if (iput_index == iput_array.length) {
        iput_index = 0;
    }
    $(".s5-3 .ipt1").val(iput_array[iput_index].txt1);
    $(".s5-3 .ipt2").val(iput_array[iput_index].txt2);
});
$(".s6-btn1").click(function() {
    ClickEvent("ENG", "ENG_UGC_Share", "Click");
    $(".mask,.popbox1").fadeIn();
});
$(".popbox1").click(function() {
    $(".mask,.popbox1").fadeOut();
});
$(".go_back1").click(function(a) {
    $(".zhuquan8").hide();
    $(".zhuquan6").show();
});
$(".s9-btn11").click(function(a) {
    ClickEvent("ENG", "ENG_Shoe1_Coupon", "Click");
    clearInterval(timeLoop);
    if (lottery == 0) {
        $(".zhuquan9").fadeOut();
        $(".zhuquan7").fadeIn();
    } else {
        showPrice(lottery, coupon);
        $(".zhuquan9").fadeOut();
        $(".zhuquan8").fadeIn();
    }
    localStorage.coupon = true;
});
$(".s6-btn2").click(function() {
    ClickEvent("ENG", "ENG_UGC_Incentive", "Click");
    if (lottery == 0) {
        ga("send", "pageview", "ACE_CRM");
        $(".zhuquan6").fadeOut();
        $(".zhuquan7").fadeIn();
    } else {
        ga("send", "pageview", "GP_Shoe2");
        showPrice(lottery, coupon);
        $(".zhuquan6").fadeOut();
        $(".zhuquan8").fadeIn();
    }
});
window.sale_index = "男";
$(".sale_chk").click(function() {
    if (!$(this).hasClass("chkOn")) {
        $(".sale_chk").removeClass("chkOn");
        $(this).addClass("chkOn");
        if ($(this).index() == 2) {
            window.sale_index = "男";
        } else {
            window.sale_index = "女";
        }
    }
});
$(".chk2-1 ,.chk2-2").click(function() {
    if (!$(this).hasClass("chk2On")) {
        $(this).addClass("chk2On");
    } else {
        $(this).removeClass("chk2On");
    }
});
$(".s7-btn").click(function() {
    ClickEvent("ACE", "ACE_CRM_Submit", "Click");
    var d = $(".input-name").val();
    var a = $(".input-age").val();
    var c = $(".input-mobile").val();
    var b = $(".input-mail").val();
    var e = $("#s_province option:selected").text();
    var g = $("#s_city option:selected").text();
    if (d == "") {
        alert("请输入姓名！");
        return;
    }
    if (a == "") {
        alert("请选择出生日期！");
        return;
    }
    if (!/^1[3|4|5|6|7|8|9][0-9]\d{8}$/.test(c)) {
        alert("手机号码输入有误!");
        return;
    }
    if (!isEmail(b)) {
        alert("请输入有效的电子邮箱！");
        return;
    }
    if (e == "" || e == "省份") {
        alert("请选择省份！");
        return;
    }
    if (g == "") {
        alert("请输入城市");
        return;
    }
    if (!$(".chk2-1").hasClass("chk2On")) {
        alert("请阅读并同意adiCLUB会员条款!");
        return;
    }
    if (!$(".chk2-2").hasClass("chk2On")) {
        alert("请阅读并接受活动规则!");
        return;
    }
    var f = {
        realname: d,
        birthday: a,
        mobile: c,
        gender: window.sale_index,
        email: b,
        province: e,
        city: g,
        agreed1: "yes",
        agreed2: "yes",
        source: source,
        source2: "atr",
        image_id: image_id
    };
    $(".ajaxloading").fadeIn();
    $.get(g_url + "api/save_crm?r=" + Math.random(), f,
    function(h) {
        $(".ajaxloading").fadeOut();
        if (h.error_code == 0) {
            $(".box-step").fadeOut();
            $(".zhuquan8").fadeIn();
            localStorage._adMoble = f.mobile;
            lottery = h.data.lottery;
            coupon = h.data.coupon;
            showPrice(lottery, coupon);
        } else {
            if (h.error_specific == "has_mobile") {
                alert("手机号码已存在！");
            } else {
                alert("服务器错误，请稍后！");
            }
        }
    },
    "jsonp");
});
function isEmail(b) {
    var a = /^[_a-zA-Z0-9-]+(\.[_a-zA-Z0-9-]+)*@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*$/;
    return a.test(b);
}
var timeLoop;
function initRoll(g) {
    var d = 1;
    var f = false;
    var n = true;
    var o = "slide";
    var l = 500;
    var b = "circle";
    var e = true;
    function h() {
        if (n) {
            if (d == 1) {
                d = 6;
            }
            console.log("woek");
            f = true;
            d--;
            e = true;
            n = false;
            $(".s1-bj").show();
            for (k = 1; k <= 6; k++) {
                var p = document.getElementById(o + k);
                p.className += " tran";
            }
            setTimeout(function() {
                c();
            },
            200);
            setTimeout(function() {
                for (k = 1; k <= 6; k++) {
                    var q = document.getElementById(o + k);
                    q.classList.remove("tran");
                }
            },
            1400);
        }
    }
    function a() {
        if (n) {
            if (d == g) {
                d = 0;
            }
            console.log("woek");
            f = true;
            d++;
            e = false;
            n = false;
            $(".s1-bj").show();
            for (k = 1; k <= g; k++) {
                var p = document.getElementById(o + k);
                // p.className += " tran";
            }
            setTimeout(function() {
                c();
            },
            200);
            setTimeout(function() {
                for (k = 1; k <= g; k++) {
                    var q = document.getElementById(o + k);
                    // q.classList.remove("tran");
                }
            },
            1400);
        }
    }
    function c() {
        if (f) {
            f = false;
            if (e) {
                for (j = 1; j <= 9; j++) {
                    var p = document.getElementById(b + j);
                    p.classList.remove("steap");
                    p.setAttribute("class", (b + j) + " streak");
                    console.log("streak");
                }
            } else {
                for (j = 10; j <= 18; j++) {
                    var p = document.getElementById(b + j);
                    p.classList.remove("steap");
                    p.setAttribute("class", (b + j) + " streak");
                    console.log("streak");
                }
            }
            setTimeout(function() {
                for (i = 1; i <= g; i++) {
                    if (i == d) {
                        var r = document.getElementById(o + i);
                        r.className += " up1";
                    } else {
                        var q = document.getElementById(o + i);
                        q.classList.remove("up1");
                    }
                }
                f = true;
            },
            600);
            setTimeout(function() {
                n = true;
                $(".s1-bj").hide();
            },
            1700);
            setTimeout(function() {
                if (e) {
                    for (j = 1; j <= 9; j++) {
                        var q = document.getElementById(b + j);
                        q.classList.remove("streak");
                        q.setAttribute("class", (b + j) + " steap");
                    }
                } else {
                    for (j = 10; j <= 18; j++) {
                        var q = document.getElementById(b + j);
                        q.classList.remove("streak");
                        q.setAttribute("class", (b + j) + " steap");
                    }
                    f = true;
                }
            },
            850);
            setTimeout(function() {
                n = true;
                $(".s1-bj").hide();
            },
            1700);
        }
    }
    var m = setTimeout(function() {
        a();
        clearTimeout(m);
        timeLoop = setInterval(function() {
            a();
        },
        4000);
    },
    2000);
}
function showPrice(b, a) {
    $(".s8-1,.s8-2").hide();
    if (b == "99") {
        $(".s8-2 ._code").html(a);
        $(".s8-2").show();
        $(".s8-2 ._tip").eq(0).show();
        $(".s8-btn1").find("img").eq(1).show();
    } else {
        if (b == "1") {
            $(".s8-2 ._code").html(a);
            $(".s8-2").show();
            $(".s8-2 ._tip").eq(1).show();
            $(".s8-btn1").find("img").eq(1).show();
        } else {
            if (b == "2") {
                $(".s8-2 ._code").html(a);
                $(".s8-2").show();
                $(".s8-2 ._tip").eq(2).show();
                $(".s8-btn1").find("img").eq(1).show();
            } else {
                if (b == "3") {
                    $(".s8-2 ._code").html(a);
                    $(".s8-2").show();
                    $(".s8-2 ._tip").eq(3).show();
                    $(".s8-btn1").find("img").eq(1).show();
                } else {
                    if (localStorage.coupon) {
                        $(".s8-1 ._code").html(a);
                        $(".s8-1").show();
                        $(".s8-btn1").find("img").eq(0).show();
                    } else {
                        $(".s8-2 ._code").html(a);
                        $(".s8-2").show();
                        $(".s8-2 ._tip").eq(4).show();
                        $(".s8-btn1").find("img").eq(1).show();
                    }
                }
            }
        }
    }
    if (image_id) {
        $(".go_back1").show();
    }
}
function is_weixin() {
    var a = navigator.userAgent.toLowerCase();
    if (a.match(/MicroMessenger/i) == "micromessenger") {
        return true;
    } else {
        return false;
    }
}